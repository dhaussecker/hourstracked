<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editable Fleet Equipment Overview</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #1e3a5f 0%, #2c4a6b 100%); 
            min-height: 100vh;
            color: white;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2c4a6b 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #22c55e;
            color: white;
            border-radius: 8px;
            display: none;
            z-index: 1000;
            animation: fadeIn 0.3s;
            font-weight: 600;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            margin: 20px auto;
            max-width: 1400px;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            margin: 5px;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn-success {
            background: #22c55e;
            color: white;
        }
        
        .btn-success:hover {
            background: #16a34a;
            transform: translateY(-1px);
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        
        .btn-danger {
            background: #dc2626;
            color: white;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .equipment-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            border: 2px solid rgba(196, 216, 45, 0.3);
            position: relative;
        }
        
        .equipment-card.editing {
            border-color: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }
        
        .equipment-card.has-changes {
            border-color: #f59e0b;
        }
        
        .card-header {
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-bottom: 1px solid #e2e8f0;
            position: relative;
        }
        
        .editable {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
            min-width: 60px;
        }
        
        .editable:hover {
            background: rgba(59, 130, 246, 0.1);
            outline: 2px dashed #3b82f6;
        }
        
        .editable.editing {
            background: white;
            outline: 2px solid #3b82f6;
        }
        
        .editable input {
            border: none;
            background: transparent;
            font: inherit;
            color: inherit;
            width: 100%;
            outline: none;
            padding: 2px;
        }
        
        .equipment-name {
            font-size: 18px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 5px;
        }
        
        .equipment-company {
            font-size: 14px;
            color: #64748b;
            margin-top: 5px;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .hours-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .hours-input {
            width: 80px;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            transition: all 0.2s;
            color: #1e293b;
        }
        
        .hours-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .hours-input.changed {
            background: #fef3c7;
            border-color: #f59e0b;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 5px;
            transition: all 0.3s ease;
        }
        
        .edit-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f59e0b;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            display: none;
        }
        
        .equipment-card.has-changes .edit-indicator {
            display: block;
        }
        
        .save-methods {
            background: rgba(255, 255, 255, 0.95);
            margin: 20px auto;
            max-width: 1400px;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .save-methods h3 {
            color: #1e293b;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .save-method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .save-method {
            padding: 20px;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        
        .save-method:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        
        .save-method h4 {
            color: #1e293b;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .save-method p {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .status-bar {
            background: rgba(255, 255, 255, 0.95);
            margin: 20px auto;
            max-width: 1400px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            color: #64748b;
            font-size: 14px;
        }
        
        .stats-display {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-value {
            font-weight: 600;
            color: #1e293b;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="save-indicator" id="saveIndicator">
        ✓ Changes saved
    </div>

    <div class="header">
        <h1>⚡ Editable Fleet Equipment Command Center</h1>
        <p>Click on any field to edit • Changes save automatically to browser storage</p>
    </div>

    <div class="control-panel">
        <div>
            <button class="btn btn-primary" onclick="saveToLocalStorage()">💾 Save to Browser</button>
            <button class="btn btn-success" onclick="exportData()">📥 Export JSON</button>
            <button class="btn btn-warning" onclick="importData()">📤 Import JSON</button>
            <input type="file" id="importFile" style="display: none;" accept=".json" onchange="handleImport(event)">
        </div>
        <div>
            <button class="btn btn-danger" onclick="resetData()">🔄 Reset to Default</button>
            <button class="btn btn-primary" onclick="generateCSV()">📊 Export CSV</button>
        </div>
    </div>

    <div class="save-methods">
        <h3>💾 Data Management Options</h3>
        <div class="save-method-grid">
            <div class="save-method">
                <h4>📱 Browser Storage</h4>
                <p>Auto-saves locally in your browser. Data persists between sessions.</p>
                <button class="btn btn-primary" onclick="saveToLocalStorage()">Save Now</button>
            </div>
            <div class="save-method">
                <h4>📁 Export/Import</h4>
                <p>Download your data as JSON file for backup or sharing.</p>
                <button class="btn btn-success" onclick="exportData()">Export Data</button>
            </div>
            <div class="save-method">
                <h4>📊 CSV Export</h4>
                <p>Export to spreadsheet format for analysis in Excel.</p>
                <button class="btn btn-warning" onclick="generateCSV()">Export CSV</button>
            </div>
            <div class="save-method">
                <h4>🔄 Sync</h4>
                <p>Copy the JSON data to integrate with your existing systems.</p>
                <button class="btn btn-primary" onclick="copyToClipboard()">Copy JSON</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="equipment-grid" id="equipmentGrid">
            <!-- Equipment cards will be generated here -->
        </div>
    </div>

    <div class="status-bar">
        <div>Last saved: <span id="lastSaved">Never</span></div>
        <div class="stats-display">
            <div class="stat-item">
                <span>Total Equipment:</span>
                <span class="stat-value" id="totalCount">0</span>
            </div>
            <div class="stat-item">
                <span>Total Hours:</span>
                <span class="stat-value" id="totalHours">0</span>
            </div>
            <div class="stat-item">
                <span>Average Usage:</span>
                <span class="stat-value" id="avgUsage">0%</span>
            </div>
        </div>
    </div>

    <script>
        // Store equipment data
        let equipmentData = [];
        let originalData = [];
        
        // Load initial data
        function loadInitialData() {
            // Check local storage first
            const savedData = localStorage.getItem('fleetEquipmentData');
            if (savedData) {
                try {
                    equipmentData = JSON.parse(savedData);
                    console.log('Loaded data from local storage');
                    document.getElementById('lastSaved').textContent = localStorage.getItem('lastSaveTime') || 'Unknown';
                } catch (e) {
                    console.error('Error loading saved data:', e);
                    loadDefaultData();
                }
            } else {
                loadDefaultData();
            }
            originalData = JSON.parse(JSON.stringify(equipmentData));
            renderEquipment();
            updateStats();
        }
        
        function loadDefaultData() {
            // Generate sample data
            equipmentData = [
                {id: "11293651", type: "Generator", brand: "United Rentals", company: "TauLab", hours_used: 75, hours_total: 100, active: true},
                {id: "11294782", type: "Compressor", brand: "United Rentals", company: "TauLab", hours_used: 45, hours_total: 100, active: true},
                {id: "11295433", type: "Light Tower", brand: "United Rentals", company: "TauLab", hours_used: 30, hours_total: 100, active: false},
                {id: "11296124", type: "Excavator", brand: "Caterpillar", company: "TauLab", hours_used: 88, hours_total: 100, active: true},
                {id: "11297856", type: "Skid Steer", brand: "Bobcat", company: "TauLab", hours_used: 62, hours_total: 100, active: true},
                {id: "11298567", type: "Forklift", brand: "Toyota", company: "TauLab", hours_used: 95, hours_total: 100, active: true},
                {id: "11299348", type: "Crane", brand: "Liebherr", company: "TauLab", hours_used: 15, hours_total: 100, active: false},
                {id: "11300129", type: "Bulldozer", brand: "Caterpillar", company: "TauLab", hours_used: 78, hours_total: 100, active: true}
            ];
        }
        
        // Render equipment cards
        function renderEquipment() {
            const grid = document.getElementById('equipmentGrid');
            grid.innerHTML = '';
            
            equipmentData.forEach((equipment, index) => {
                const percentage = (equipment.hours_used / equipment.hours_total) * 100;
                const color = getStatusColor(percentage);
                const status = getStatus(percentage);
                
                const card = document.createElement('div');
                card.className = 'equipment-card';
                card.id = `card-${equipment.id}`;
                
                card.innerHTML = `
                    <div class="edit-indicator">Modified</div>
                    <div class="card-header">
                        <div class="equipment-name">
                            <span class="editable" 
                                  data-field="type" 
                                  data-index="${index}"
                                  onclick="makeEditable(this)">
                                ${equipment.type}
                            </span>
                            <span style="color: #94a3b8; font-size: 14px; margin-left: 8px;">#${equipment.id}</span>
                        </div>
                        <div class="equipment-company">
                            Company: 
                            <span class="editable" 
                                  data-field="company" 
                                  data-index="${index}"
                                  onclick="makeEditable(this)">
                                ${equipment.company}
                            </span>
                            <span style="margin: 0 8px;">•</span>
                            Brand: 
                            <span class="editable" 
                                  data-field="brand" 
                                  data-index="${index}"
                                  onclick="makeEditable(this)">
                                ${equipment.brand}
                            </span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="hours-input-group">
                            <label style="color: #64748b; font-weight: 500;">Hours:</label>
                            <input type="number" 
                                   class="hours-input" 
                                   value="${equipment.hours_used}"
                                   min="0"
                                   max="${equipment.hours_total}"
                                   data-index="${index}"
                                   data-original="${equipment.hours_used}"
                                   onchange="updateHours(this)"
                                   oninput="highlightChange(this)">
                            <span style="color: #64748b;">/ ${equipment.hours_total}</span>
                            <span style="color: ${color}; font-weight: 600; font-size: 18px;">${percentage.toFixed(0)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" 
                                 id="progress-${equipment.id}"
                                 style="width: ${percentage}%; background: linear-gradient(90deg, ${color}, ${adjustColor(color, 20)});"></div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: ${color}22; border-radius: 6px; margin-top: 10px;">
                            <span style="color: ${color}; font-weight: 600; font-size: 14px;">
                                Status: ${status}
                            </span>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        // Make field editable
        function makeEditable(element) {
            if (element.classList.contains('editing')) return;
            
            const currentValue = element.textContent.trim();
            const field = element.dataset.field;
            const index = element.dataset.index;
            
            element.classList.add('editing');
            element.innerHTML = `<input type="text" value="${currentValue}" onblur="saveEdit(this)" onkeypress="handleKeyPress(event, this)">`;
            element.querySelector('input').focus();
            element.querySelector('input').select();
        }
        
        // Save edited field
        function saveEdit(input) {
            const element = input.parentElement;
            const field = element.dataset.field;
            const index = element.dataset.index;
            const newValue = input.value.trim();
            
            if (newValue && newValue !== equipmentData[index][field]) {
                equipmentData[index][field] = newValue;
                element.classList.remove('editing');
                element.textContent = newValue;
                
                // Mark card as changed
                const card = document.getElementById(`card-${equipmentData[index].id}`);
                card.classList.add('has-changes');
                
                autoSave();
            } else {
                element.classList.remove('editing');
                element.textContent = equipmentData[index][field];
            }
        }
        
        // Handle key press in edit mode
        function handleKeyPress(event, input) {
            if (event.key === 'Enter') {
                input.blur();
            } else if (event.key === 'Escape') {
                const element = input.parentElement;
                const field = element.dataset.field;
                const index = element.dataset.index;
                element.classList.remove('editing');
                element.textContent = equipmentData[index][field];
            }
        }
        
        // Update hours
        function updateHours(input) {
            const index = input.dataset.index;
            const value = parseInt(input.value) || 0;
            const maxValue = equipmentData[index].hours_total;
            
            // Clamp value
            const clampedValue = Math.max(0, Math.min(value, maxValue));
            input.value = clampedValue;
            
            if (clampedValue !== equipmentData[index].hours_used) {
                equipmentData[index].hours_used = clampedValue;
                
                // Update progress bar
                const percentage = (clampedValue / maxValue) * 100;
                const color = getStatusColor(percentage);
                const progressBar = document.getElementById(`progress-${equipmentData[index].id}`);
                progressBar.style.width = percentage + '%';
                progressBar.style.background = `linear-gradient(90deg, ${color}, ${adjustColor(color, 20)})`;
                
                // Update percentage display
                const card = document.getElementById(`card-${equipmentData[index].id}`);
                const percentDisplay = card.querySelector('.hours-input-group span[style*="font-size: 18px"]');
                if (percentDisplay) {
                    percentDisplay.textContent = percentage.toFixed(0) + '%';
                    percentDisplay.style.color = color;
                }
                
                // Update status display
                const statusDisplay = card.querySelector('.card-body > div:last-child span');
                if (statusDisplay) {
                    statusDisplay.textContent = 'Status: ' + getStatus(percentage);
                    statusDisplay.style.color = color;
                    statusDisplay.parentElement.style.background = color + '22';
                }
                
                // Mark card as changed
                card.classList.add('has-changes');
                
                autoSave();
                updateStats();
            }
        }
        
        // Highlight changed input
        function highlightChange(input) {
            const original = parseInt(input.dataset.original);
            const current = parseInt(input.value);
            if (current !== original) {
                input.classList.add('changed');
            } else {
                input.classList.remove('changed');
            }
        }
        
        // Get status color based on percentage
        function getStatusColor(percentage) {
            if (percentage <= 50) return '#22c55e';
            if (percentage <= 90) return '#f59e0b';
            return '#dc2626';
        }
        
        // Get status text
        function getStatus(percentage) {
            if (percentage <= 50) return 'Good';
            if (percentage <= 90) return 'Maintenance Required';
            return 'Critical';
        }
        
        // Adjust color brightness
        function adjustColor(color, percent) {
            const num = parseInt(color.replace("#",""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R<255?R<1?0:R:255)*0x10000 + (G<255?G<1?0:G:255)*0x100 + (B<255?B<1?0:B:255)).toString(16).slice(1);
        }
        
        // Update statistics
        function updateStats() {
            const totalEquipment = equipmentData.length;
            const totalHours = equipmentData.reduce((sum, eq) => sum + eq.hours_used, 0);
            const avgUsage = equipmentData.reduce((sum, eq) => sum + (eq.hours_used / eq.hours_total * 100), 0) / totalEquipment;
            
            document.getElementById('totalCount').textContent = totalEquipment;
            document.getElementById('totalHours').textContent = totalHours;
            document.getElementById('avgUsage').textContent = avgUsage.toFixed(1) + '%';
        }
        
        // Auto-save to local storage
        function autoSave() {
            saveToLocalStorage(true);
        }
        
        // Save to local storage
        function saveToLocalStorage(silent = false) {
            localStorage.setItem('fleetEquipmentData', JSON.stringify(equipmentData));
            const saveTime = new Date().toLocaleString();
            localStorage.setItem('lastSaveTime', saveTime);
            document.getElementById('lastSaved').textContent = saveTime;
            
            if (!silent) {
                showSaveIndicator('Saved to browser storage');
            }
        }
        
        // Export data as JSON
        function exportData() {
            const exportObj = {
                equipment: equipmentData,
                exported_at: new Date().toISOString(),
                version: "1.0"
            };
            const dataStr = JSON.stringify(exportObj, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `fleet_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            showSaveIndicator('Data exported successfully');
        }
        
        // Generate CSV
        function generateCSV() {
            let csv = 'ID,Type,Brand,Company,Hours Used,Hours Total,Percentage,Status\n';
            equipmentData.forEach(eq => {
                const percentage = (eq.hours_used / eq.hours_total * 100).toFixed(1);
                const status = getStatus(percentage);
                csv += `${eq.id},"${eq.type}","${eq.brand}","${eq.company}",${eq.hours_used},${eq.hours_total},${percentage},"${status}"\n`;
            });
            
            const blob = new Blob([csv], {type: 'text/csv'});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `fleet_data_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            showSaveIndicator('CSV exported successfully');
        }
        
        // Copy to clipboard
        function copyToClipboard() {
            const dataStr = JSON.stringify(equipmentData, null, 2);
            navigator.clipboard.writeText(dataStr).then(() => {
                showSaveIndicator('JSON copied to clipboard');
            }).catch(err => {
                console.error('Failed to copy:', err);
                showSaveIndicator('Failed to copy to clipboard');
            });
        }
        
        // Import data
        function importData() {
            document.getElementById('importFile').click();
        }
        
        // Handle import
        function handleImport(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const imported = JSON.parse(e.target.result);
                        // Handle both direct array and object with equipment property
                        if (Array.isArray(imported)) {
                            equipmentData = imported;
                        } else if (imported.equipment && Array.isArray(imported.equipment)) {
                            equipmentData = imported.equipment;
                        } else {
                            throw new Error('Invalid data format');
                        }
                        renderEquipment();
                        saveToLocalStorage();
                        updateStats();
                        showSaveIndicator('Data imported successfully');
                    } catch (error) {
                        alert('Invalid JSON file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        }
        
        // Reset to default data
        function resetData() {
            if (confirm('Reset all changes to default values? This will clear all your edits.')) {
                localStorage.removeItem('fleetEquipmentData');
                localStorage.removeItem('lastSaveTime');
                loadDefaultData();
                renderEquipment();
                updateStats();
                document.getElementById('lastSaved').textContent = 'Never';
                
                // Remove all change indicators
                document.querySelectorAll('.equipment-card').forEach(card => {
                    card.classList.remove('has-changes');
                });
                
                showSaveIndicator('Reset to defaults');
            }
        }
        
        // Show save indicator
        function showSaveIndicator(message) {
            const indicator = document.getElementById('saveIndicator');
            indicator.textContent = '✓ ' + message;
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 3000);
        }
        
        // Initialize on load
        window.onload = loadInitialData;
        
        // Auto-save on page unload
        window.addEventListener('beforeunload', function(e) {
            saveToLocalStorage(true);
        });
        
        // Periodic auto-save every 30 seconds
        setInterval(() => {
            if (equipmentData.length > 0) {
                saveToLocalStorage(true);
            }
        }, 30000);
    </script>
<!-- Updated: 2025-08-16 13:30:33 -->
</body>
</html>